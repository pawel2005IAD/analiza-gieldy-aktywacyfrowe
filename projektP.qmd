---
title: "Zmienność rynkowa indeksu S&P 500 i aktywów cyfrowych – analiza porównawcza"
author: "Paweł Zdanowski"
format:
  html:
    embed-resources: true
    number-sections: true
    number-depth: 1
    theme: cosmo
    toc: true
    toc-location: left
    toc-title: "Spis treści"
    toc-depth: 3
    smooth-scroll: true
execute:
  echo: false
  warning: false
  message: false
---

```{r}

library(tidyquant)
library(tidyverse)
library(scales)

# Pobieranie danych 2015-2023
symbols <- c("^GSPC", "BTC-USD", "ETH-USD", "LTC-USD")
raw_data <- tq_get(symbols, from = "2015-01-01", to = "2023-12-31")


comparison_data <- raw_data %>%
  select(symbol, date, close) %>%
  group_by(symbol) %>%
  mutate(
    # Zmienność jako różnica w cenie (USD / punkty)
    volatility_usd = abs(close - lag(close)),
    index_price = (close / first(close)) * 100
  ) %>%
  na.omit()

# Czytelne nazwy
comparison_data$symbol <- recode(comparison_data$symbol, 
                                 "^GSPC" = "S&P 500",
                                 "BTC-USD" = "Bitcoin",
                                 "ETH-USD" = "Ethereum",
                                 "LTC-USD" = "Litecoin")

```

# Wstęp i cel badania

Niniejszy projekt stanowi szczegółowe porównawnanie dynamiki zmian na tradycyjnym amerykańskim rynku kapitałowym oraz rodzącym się rynku aktywów cyfrowych w latach 2015–2023. Głównym celem pracy jest analiza zmienności (*volatility*) spółek wchodzących w skład indeksu S&P 500 oraz zestawienie tych wyników z trendami panującymi na rynku kryptowalut. Badanie opiera się na dwóch komplementarnych filarach danych: obszernym zbiorze historycznym dla ponad 500 spółek giełdowych oraz danych rynkowych dla Bitcoina, Litecoina i Ethereum, pobranych bezpośrednio z serwisu Yahoo Finance przy użyciu biblioteki `tidyquant`. Kluczowym wskaźnikiem poddanym analizie jest zmienność dzienna, zdefiniowana jako różnica między ceną najwyższą a najniższą, zewzględu na znaczące różnice w wartościach nominalnych badanych aktywów (od kilku do kilkudziesięciu tysięcy dolarów), dokonano normalizacji cen do bazy 100. Dzięki temu wykresy nie pokazują ceny w walucie, lecz dynamikę procentową zmian.Zwerifikuję osiem następujących pytań oraz hipotez badawczych:

-   **Zyski: Aktywa cyfrowe vs. Rynek kapitałowy** – porównanie stóp zwrotu.

-   **Zmienność dzienna** – porównanie stabilności S&P 500 i Aktywów cyfrowych

-   **Wpływ pandemii COVID-19** – mechanizm katalizatora wzrostów rynkowych.

-   **Konwergencja rynków**– czy Aktywa cyfrowa upodabnia się do giełdy tradycyjnej

-   **Ekstremalne szoki rynkowe** – analiza częstotliwości

-   **Analiza Drawdown** – głębokość spadków i czas odrabiania strat.

-   **Korelacja i portfel mieszany** – czy warto łączyć akcje z kryptowalutami?

-   **Lokata bankowa a rynkek giełdowy** – bezpieczeństwo kontra potencjał wzrostu.

-   **Podsumowanie i wnioski** – rekomendacje dla inwestora.

# Dane

**symbol-**Nazwa instrumentu finansowego

**date**-Data Notowania

**close**- Dzienna cena zamknięcia instrumentu finansowego

**volatility_usd**-Bezwzględna zmienność dzienna

**index_price**-Znormalizowana cena startująca od poziomu 100 punktów

# Analiza porównawcza stóp zwrotu: Aktywa cyfrowe vs. Rynek kapitałowy

```{r}
library(tidyverse)
library(gganimate)
library(viridis)
library(scales)


s <- comparison_data %>%
  ggplot(aes(x = date, y = index_price, group = symbol, color = symbol)) +
    geom_line(linewidth = 0.8) +
    geom_point(size = 1.5) +
    scale_color_viridis(discrete = TRUE) +
    scale_y_log10(labels = label_comma()) + 
    labs(
      title = "Wzrost wartości aktywów od 2015 roku",
      y = "Wartość ",
      x = "Rok",
      color = "Instrument"
    ) +
    theme_minimal() +
    transition_reveal(date)

options(gganimate.dev = "ragg_png")


moje_gif <- animate(
  s,
  nframes = 200,
  fps = 20,
  width = 800,
  height = 450,
  units = "px",     
  renderer = gifski_renderer()
)

moje_gif
```

W tej części sprawdzamy, ile zarobilibyśmy inwestując w 2015 roku w każdy z instrumentów. Animacja pokazuje wyraźną przepaść: podczas gdy S&P 500 rośnie stabilnie i powoli, Bitcoin oraz Ethereum charakteryzują się gwałtownymi i bardzo stromymi skokami wartości. Mimo drastycznych spadków po drodze, ich ostateczny zysk wielokrotnie przewyższa wyniki tradycyjnej giełdy. Hipoteza została potwierdzona: rynek cyfrowy oferuje stopy zwrotu nieosiągalne dla tradycyjnych akcji, choć wiąże się to z ogromnymi wahaniami kursu.

# Dzienna zmienność kryptowalut jest wyższa niż zmienność indeksu S&P 500.

```{r}
library(ggplot2)
ggplot(comparison_data, aes(x = symbol, y = volatility_usd, fill = symbol)) +
  geom_boxplot(outlier.alpha = 0.1) +
  # Skala logarytmiczna 
  scale_y_log10(labels = label_comma()) + 
  theme_minimal() +
  labs(
    title = " Dzienna zmienność aktywów finansowych",
    x = "Instrument",
    y = "Wartość zmiany dziennej "
  ) +
  theme(legend.position = "none")

```

Wykres jednoznacznie obrazuje kolosalną różnicę w poziomie ryzyka między badanymi klasami aktywów. Indeks S&P 500 wykazuje minimalne wahania dzienne, co czyni go aktywem stabilnym i przewidywalnym na tle kryptowalut. Bitcoin oraz Ethereum charakteryzują się gigantyczną zmiennością, a ich rozkład na wykresie dowodzi ogromnej skali niepewności rynkowej.Mniejsza zmienność kwotowa LTC wynika z jego niskiej ceny, jednak liczne wartości odstające potwierdzają, że to wciąż instrument znacznie bardziej ryzykowny niż stabilny S&P 500. Liczne punkty odstające to dowód na gwałtowne, ekstremalne skoki cen, które na tradycyjnej giełdzie niemal nie występują. Wyniki te ostatecznie potwierdzają hipotezę: rynek kryptowalut jest wielokrotnie bardziej ryzykowny, a typowe dzienne ruchy cen Bitcoina często przekraczają najbardziej nerwowe momenty na standardowym rynku akcji.

# Pandemia COVID-19 jako katalizator bezprecedensowej hossy rynkowej

```{r}
library(tidyverse)
library(scales)
library(ragg)
 dane_pandemia <- comparison_data %>% 
   filter(date >= "2019-01-01" & date  <= "2022-01-01")
 
 ggplot(dane_pandemia, aes(x = date, y = index_price, color = symbol)) +
  geom_line(linewidth = 1) +
    annotate("rect", xmin = as.Date("2020-03-01"), xmax = as.Date("2020-04-15"), 
           ymin = 0, ymax = Inf, alpha = 0.2, fill = "red") +
    annotate("text", x = as.Date("2020-03-15"), y = 1000, label = "Crash COVID", 
           color = "red", angle = 90, vjust = -0.5) +
    scale_y_log10(labels=label_comma())+
   scale_color_viridis_d() +
  labs(
    title = "Wpływ pandemii na rynki (2019-2022)",
    x = "Rok",
    y = "Wartość ",
    color = "Instrument"
  ) +
  theme_minimal()
    

```

Analiza okresu 2019–2022 potwierdza, że choć marzec 2020 przyniósł gwałtowny krach na wszystkich rynkach, to późniejsza cyfryzacja i stymulacja gospodarki napędziły historyczne wzrosty. Na wykresie widać wyraźną dominację kryptowalut w fazie odbicia po pandemii. W 2015 roku Litecoin oraz Bitcoin był bardzo tani, jego wzrost do kilkuset dolarów sprawił, że początkowe 100 USD zamieniło się w tysiące dolarów zysku. Ostatecznie dane potwierdzają hipotezę: choć S&P 500 odnotował solidne odbicie i ustanowił nowe historyczne rekordy, to skala zwrotu z inwestycji w kryptowaluty w okresie popandemicznym była o rzędy wielkości wyższa.

# Czy Aktywa cyfrowe coraz bardziej przypominają Rynek kapitałowy

```{r}
# 1. Przygotowanie danych do korelacji 
data_corr <- comparison_data %>%
  group_by(symbol) %>%
  mutate(daily_return = (close - lag(close)) / lag(close)) %>%
  filter(!is.na(daily_return)) %>%
  select(date, symbol, daily_return) %>%
  # Rozbijamy tabelę
  pivot_wider(names_from = symbol, values_from = daily_return) %>%
  na.omit()

# 2. Wykres rozrzutu 
ggplot(data_corr, aes(x = `S&P 500`, y = Bitcoin)) +
  geom_point(alpha = 0.3, color = "#2c3e50") + # Kropki z przezroczystością
  geom_smooth(method = "lm", color = "#e74c3c", se = TRUE) + # Linia trendu
  scale_x_continuous(labels = percent) +
  scale_y_continuous(labels = percent) +
  labs(
    title = "Korelacja dziennych zwrotów: S&P 500 vs Bitcoin",
    x = "Dzienna zmiana S&P 500",
    y = "Dzienna zmiana Bitcoin"
  ) +
  theme_minimal()
```

Badanym zjawiskiem w niniejszym raporcie jest wzajemna zależność rynków, zwizualizowana za pomocą wykresu rozrzutu (Scatter Plot). Oś pozioma (X) reprezentuje dzienne zwroty indeksu S&P 500.Oś pionowa (Y) w analogiczny pokazuje dzienne zwroty Bitcoina. Analiza danych potwierdza, że Bitcoin przestał być aktywem całkowicie niezależnym. Widoczna na wykresie czerwona linia trendu pnie się w górę, co jest bezpośrednim dowodem na występowanie dodatniej korelacji. Oznacza to, że oba rynki coraz częściej reagują na te same sygnały makroekonomiczne. Wizualizacja ujawnia jednak istotną asymetrię w dynamice tych ruchów Bitcoin reaguje na te same impulsy co giełda, ale z kilkukrotnie większą amplitudą. Można to zauważyć, porównując skale osi: podczas gdy punkty dla S&P 500 skupiają się głównie w wąskim przedziale +/- 3%, punkty Bitcoina są rozproszone pionowo w znacznie szerszym zakresie, sięgającym +/- 10% lub więcej. Kryptowaluty oferują tym samym wyższy potencjał zysku przy radykalnie większym ryzyku spadków.

# Analiza częstotliwości występowania ekstremalnych szoków rynkowych

```{r}
library(tidyverse)
library(scales)
#liczymy dni  dni powyżej 5% lub poniżej -5% dziennie
max_day <- comparison_data %>% 
  group_by(symbol) %>% 
mutate(daily_return = (close - lag(close)) / lag(close)) %>%
filter(abs(daily_return) > 0.05) %>%
  summarise(liczba_dni=n())

ggplot(max_day, aes(x = reorder(symbol, -liczba_dni), y = liczba_dni, fill = symbol)) +
  geom_col() +
  scale_fill_viridis_d() +
  labs(
    title = "występowania ekstremalnych zdarzeń rynkowych",
    x = "Aktywo",
    y = "Liczba dni z ekstremalną zmianą"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

```

Wykres słupkowy podlicza dni od 2015 roku, w których cena danego aktywa zmieniła się o ponad 5% w ciągu jednej doby. Takie "szoki" cenowe są rzadkością na tradycyjnej giełdzie S&P 500, co potwierdza jej stabilność i czyni ją idealnym miejscem do spokojnego, długoterminowego inwestowania w modelu "kup i trzymaj”. Zupełnie inny obraz wyłania się z analizy kryptowalut – wysokie słupki dla Bitcoina, Ethereum i Litecoina pokazują, że gwałtowne skoki i spadki są tam codziennością. Ta ogromna dynamika sprawia, że kryptowaluty są doskonałym narzędziem do aktywnego tradingu, dając szansę na wypracowanie zysków w krótkim czasie, co na tradycyjnej giełdzie jest niemal niemożliwe. Podsumowując, wykres ten udowadnia, że podczas gdy giełda jest fundamentem stabilnego portfela, kryptowaluty są paliwem dla traderów szukających okazji w codziennej zmienności rynku.

# **Analiza odporności na straty** – jak duże były spadki kapitału i jak długo trwało ich odrobienie.

```{r}
library(tidyverse)
library(scales)

drawdown_data <- comparison_data %>% 
  group_by(symbol) %>% 
  mutate( 
    peak= cummax(close),
    drawdown= (close - peak ) / peak
    )
ggplot(drawdown_data,aes(x=date, y=drawdown,fill=symbol))+
  geom_area(alpha = 0.5) +
  facet_wrap(~symbol, scales = "free_x") +
  scale_y_continuous(labels = percent) +
  labs(
    title =  "Ile traciły aktywa od swoich rekordów?",
    x = "Rok",
    y = "Spadek od szczytu (%)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

Wykres obszarowy przedstawia historię strat, pokazując, o ile procent cena każdego aktywa była niższa od swojego ostatniego rekordu w danym momencie. Analiza ta w pełni potwierdza hipotezę o ekstremalnym ryzyku kryptowalut. Podczas gdy indeks S&P 500 rzadko spada poniżej poziomu -20% i zazwyczaj relatywnie szybko odrabia straty, kryptowaluty takie jak Bitcoin czy Ethereum regularnie doświadczają spadków rzędu -50%, a nawet -80%. Wizualizacja pokazuje, że inwestorzy krypto spędzają znacznie więcej czasu „pod wodą”, czekając latami na powrót ceny do poprzedniego szczytu. Wykres ten jest najlepszym dowodem na to, że ogromne zyski z kryptowalut są okupione gigantycznym obciążeniem psychicznym – inwestor musi być gotowy na zaakceptowanie faktu, że jego portfel może stracić większość wartości i nie odrobić tego przez bardzo długi czas. S&P 500 na tym tle wygląda jak stabilny fundament, który zapewnia ochronę kapitału nawet w trudnych okresach rynkowych.

# Akcje i kryptowaluty jako komplementarne elementy portfela inwestycyjnego

```{r}
library(tidyquant)
library(tidyverse)
library(reshape2) 




cor_data <- raw_data %>%
  select(symbol, date, close) %>%
  group_by(symbol) %>%
  mutate(daily_ret = (close - lag(close)) / lag(close)) %>%
  na.omit() %>%
  select(date, symbol, daily_ret) %>%

  mutate(symbol = recode(symbol, 
                         "^GSPC" = "S&P 500",
                         "BTC-USD" = "Bitcoin",
                         "ETH-USD" = "Ethereum",
                         "LTC-USD" = "Litecoin")) %>%
 
  pivot_wider(names_from = symbol, values_from = daily_ret) %>%
  select(-date)


cor_matrix <- cor(cor_data, use = "complete.obs")


melted_cor <- melt(cor_matrix)


ggplot(melted_cor, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile(color = "white") + 
  scale_fill_gradient2(low = "#0000FF", high = "#FF0000", mid = "#FFFFFF", 
                       midpoint = 0, limit = c(-1, 1), space = "Lab", 
                       name = "Korelacja") +
  geom_text(aes(label = round(value, 2)), color = "black", size = 5) + 
  labs(
    title = "Macierz Korelacji: Giełda vs Kryptowaluty",
    x = "", y = ""
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))

```

Utworzona macierz korelacji potwierdza, że kryptowaluty stanowią odrębną klasę aktywów względem tradycyjnej giełdy. Podczas gdy cyfrowe waluty są ze sobą silnie powiązane (współczynnik powyżej 0.75, ich korelacja z indeksem S&P 500 pozostaje na niskim poziomie (ok. 0.28). Dzięki temu, że S&P 500 i kryptowaluty rzadko spadają z tych samych powodów w tym samym czasie, łączny portfel będzie miał łagodniejsze wahania niż portfel składający się z samych kryptowalut.

# Bezpieczeństwo lokaty bankowej a potencjał rynku giełdowego

```{r}
start_capital <- 10000

sp500_growth <- comparison_data %>% 
  filter(symbol== "S&P 500") %>% 
  arrange(date) %>% 
  mutate(invested_value = start_capital * (close / first(close)),
    type = "S&P 500 "
  )

start_date <- min(sp500_growth$date)

lokata_growth <- sp500_growth %>% 
  mutate(days_passed = as.numeric(date - start_date),
       invested_value = start_capital * (1.045)^(days_passed / 365), 
       type = "Lokata Bankowa (4,5%)"
       )
plot_data <- bind_rows(sp500_growth,lokata_growth)

ggplot(plot_data, aes(x = date, y = invested_value, color = type)) +
         geom_line(size = 1.2) +
         scale_y_continuous(labels = dollar_format(), breaks = seq(0, 30000, 5000)) +
  labs(
    title = " Lokata vs Giełda (2015-2023)",
    x = "Rok",
    y = "Wartość portfela (USD)",
    color = "Rodzaj inwestycji"
  ) +
  theme_minimal()
```

Analiza porównawcza kwoty 10 000 USD zainwestowanej w 2015 roku pokazuje ogromną różnicę w końcowym majątku w zależności od wybranej strategii. Po 8 latach inwestor dysponuje kwotą około 15 000 USD. Jest to zysk pewny, który nie kosztował inwestora żadnego stresu, jednak ledwo chronił kapitał przed inflacją. Zupełnie inaczej wygląda sytuacja w przypadku S&P 500. Choć linia giełdy jest "poszarpana" i widać na niej bolesne spadki . Ten sam kapitał 10 000 USD urósł na giełdzie do poziomu ponad 25 000 USD. Oznacza to, że cierpliwy inwestor, który zaakceptował ryzyko i wahania kursu, zarobił o 10 000 USD więcej niż osoba trzymająca pieniądze w banku. „Przeciętny inwestor, który po prostu regularnie kupuje fundusz indeksowy S&P 500, w długim terminie osiągnie lepsze wyniki niż większość profesjonalistów. Kluczem nie jest unikanie ryzyka, lecz cierpliwość”. — *Warren Buffett*

# Podsumowanie

Analiza wykazała, że kryptowaluty oferują potężne zyski, lecz wymagają akceptacji drastycznej zmienności i spadków sięgających 80%. Indeks S&P 500 pozostaje fundamentem stabilności, systematycznie pokonując lokaty bankowe w długim terminie. Kluczowym wnioskiem jest niska korelacja (0,28) między tymi aktywami, co dowodzi, że giełda i krypto to odrębne światy inwestycyjne. Taka zależność sprawia, że portfel mieszany jest najbardziej efektywnym rozwiązaniem. Pozwala on na skuteczną dywersyfikację, łącząc bezpieczeństwo tradycyjnych akcji z wysoką dynamiką aktywów cyfrowych, co ostatecznie optymalizuje stosunek zysku do ryzyka.

# Bibliografia

**Yahoo Finance (2024)**. *Historical Market Data: S&P 500 Index (\^GSPC), Bitcoin (BTC-USD), Ethereum (ETH-USD), Litecoin (LTC-USD).* Dane historyczne za lata 2015–2023 pobrane automatycznie przy użyciu interfejsu API. Dostępne na: <https://finance.yahoo.com>.

**Buffett, W. E. (2013).** *Berkshire Hathaway Inc. Annual Report: Letter to Shareholders.* Omaha, NE. (Źródło cytatu dotyczącego efektywności inwestowania w indeks S&P 500 względem bezpiecznych aktywów gotówkowych).
